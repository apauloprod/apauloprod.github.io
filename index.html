<!-- social_site/index.php -->
<?php
session_start();
if (isset($_SESSION['user_id'])) {
    header("Location: home.php");
    exit();
}
?>


<!DOCTYPE html>
<html>
<head>
    <title>Social Site</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Welcome to Social Site</h1>
    <a href="signup.php">Sign Up</a> | <a href="login.php">Login</a>
</body>
</html>

<!-- profile.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <h1>SocialSite</h1>
    <nav>
        <a href="feed.html">Home</a>
        <a href="logout.php">Logout</a>
    </nav>
</header>

<div class="profile-container">
    <div class="profile-pic">
        <img src="uploads/profile.jpg" alt="Profile Picture" width="150">
    </div>
    <div class="profile-details">
        <h2>@username</h2>
        <div class="profile-stats">
            <div><strong>34</strong> posts</div>
            <div><strong>128</strong> followers</div>
            <div><strong>87</strong> following</div>
        </div>
        <div class="profile-bio">
            <p>Name: Jane Doe</p>
            <p>Age: 26</p>
            <p>Bio: Explorer | Music Lover | Designer</p>
        </div>
    </div>
</div>
</body>
</html>

<!-- feed.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Feed</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <h1>SocialSite</h1>
    <nav>
        <a href="profile.html">Profile</a>
        <a href="logout.php">Logout</a>
    </nav>
</header>

<div class="feed-container">
    <div class="post">
        <div class="post-header">
            <img src="uploads/profile1.jpg" alt="User">
            <span>@johndoe</span>
        </div>
        <img class="post-img" src="uploads/post1.jpg" alt="Post">
        <div class="post-content">
            <div class="post-actions">
                <a href="#">Like</a>
                <a href="#">Comment</a>
                <a href="#">Share</a>
            </div>
            <p>Had an amazing time at the beach today! ‚òÄÔ∏èüåä</p>
        </div>
    </div>

    <div class="post">
        <div class="post-header">
            <img src="uploads/profile2.jpg" alt="User">
            <span>@alice</span>
        </div>
        <img class="post-img" src="uploads/post2.jpg" alt="Post">
        <div class="post-content">
            <div class="post-actions">
                <a href="#">Like</a>
                <a href="#">Comment</a>
                <a href="#">Share</a>
            </div>
            <p>New artwork just dropped! üé®‚ú®</p>
        </div>
    </div>
</div>
</body>
</html>


<!-- social_site/db.php -->
<?php
$host = 'localhost';
$db = 'socialsite';
$user = 'postgres';
$pass = 'Visionary88!';
$conn = pg_connect("host=$host dbname=$db user=$user password=$pass");
if (!$conn) {
    die("Connection failed: " . pg_last_error());
}
?>

<!-- social_site/signup.php -->
<?php
require 'db.php';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $username = $_POST['username'];
    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);
    $sql = "INSERT INTO users (username, password) VALUES ($1, $2)";
    $result = pg_query_params($conn, $sql, array($username, $password));
    if ($result) {
        header("Location: login.php");
        exit();
    } else {
        echo "Signup failed.";
    }
}
?>
<form method="POST">
    Username: <input type="text" name="username" required><br>
    Password: <input type="password" name="password" required><br>
    <input type="submit" value="Sign Up">
</form>

<!-- social_site/login.php -->
<?php
require 'db.php';
session_start();
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $username = $_POST['username'];
    $password = $_POST['password'];
    $sql = "SELECT id, password FROM users WHERE username = $1";
    $result = pg_query_params($conn, $sql, array($username));
    if ($result && pg_num_rows($result) > 0) {
        $row = pg_fetch_assoc($result);
        if (password_verify($password, $row['password'])) {
            $_SESSION['user_id'] = $row['id'];
            header("Location: home.php");
            exit();
        }
    }
    echo "Login failed.";
}
?>
<form method="POST">
    Username: <input type="text" name="username" required><br>
    Password: <input type="password" name="password" required><br>
    <input type="submit" value="Login">
</form>

<!-- social_site/home.php -->
<?php
require 'db.php';
session_start();
if (!isset($_SESSION['user_id'])) {
    header("Location: index.php");
    exit();
}
$user_id = $_SESSION['user_id'];
?>
<h1>Welcome!</h1>
<a href="profile.php">Edit Profile</a> | <a href="post.php">New Post</a> | <a href="feed.php">Community Board</a> | <a href="logout.php">Logout</a>

<!-- social_site/logout.php -->
<?php
session_start();
session_destroy();
header("Location: index.php");
exit();
?>

<!-- social_site/profile.php -->
<?php
require 'db.php';
session_start();
if (!isset($_SESSION['user_id'])) exit();
$user_id = $_SESSION['user_id'];
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $name = $_POST['name'];
    $age = $_POST['age'];
    $bio = $_POST['bio'];
    $pic = '';
    if (isset($_FILES['profile_pic'])) {
        $target = 'uploads/' . basename($_FILES['profile_pic']['name']);
        move_uploaded_file($_FILES['profile_pic']['tmp_name'], $target);
        $pic = $target;
    }
    $sql = "UPDATE users SET name=$1, age=$2, bio=$3, profile_pic=$4 WHERE id=$5";
    $params = array($name, $age, $bio, $pic, $user_id);
    pg_query_params($conn, $sql, $params);
    echo "Profile updated.";
}
?>
<form method="POST" enctype="multipart/form-data">
    Name: <input type="text" name="name"><br>
    Age: <input type="number" name="age"><br>
    Bio: <textarea name="bio"></textarea><br>
    Profile Picture: <input type="file" name="profile_pic"><br>
    <input type="submit" value="Save">
</form>

<!-- social_site/post.php -->
<?php
require 'db.php';
session_start();
if (!isset($_SESSION['user_id'])) exit();
$user_id = $_SESSION['user_id'];
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $content = $_POST['content'];
    $media = '';
    if (isset($_FILES['media'])) {
        $target = 'uploads/' . basename($_FILES['media']['name']);
        move_uploaded_file($_FILES['media']['tmp_name'], $target);
        $media = $target;
    }
    $sql = "INSERT INTO posts (user_id, content, media) VALUES ($1, $2, $3)";
    $params = array($user_id, $content, $media);
    pg_query_params($conn, $sql, $params);
    echo "Post uploaded.";
}
?>
<form method="POST" enctype="multipart/form-data">
    Content: <textarea name="content"></textarea><br>
    Media (Image/Video): <input type="file" name="media"><br>
    <input type="submit" value="Post">
</form>

<!-- social_site/feed.php -->
<?php
require 'db.php';
$sql = "SELECT posts.id, users.username, content, media FROM posts JOIN users ON posts.user_id = users.id ORDER BY posts.id DESC";
$result = pg_query($conn, $sql);
while ($row = pg_fetch_assoc($result)) {
    echo "<div><h3>" . htmlspecialchars($row['username']) . "</h3>";
    echo "<p>" . htmlspecialchars($row['content']) . "</p>";
    if ($row['media']) echo "<img src='" . htmlspecialchars($row['media']) . "' width='200'><br>";
    echo "<a href='like.php?post_id={$row['id']}'>Like</a> | <a href='comment.php?post_id={$row['id']}'>Comment</a> | <a href='share.php?post_id={$row['id']}'>Share</a>";
    echo "</div><hr>";
}
?>
